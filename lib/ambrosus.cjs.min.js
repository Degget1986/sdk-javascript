'use strict';var handleResponse=function(a){return new Promise(function(b,c){var d={status:a.status,data:null,message:JSON.parse(a.response).reason};(200===a.status||201===a.status)&&(d.data=JSON.parse(a.response),d.message='success',b(d)),c(d)})},rejectResponse=function(a){return{status:400,data:null,message:a}},classCallCheck=function(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')},createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Assets=function(){function a(b,c){var d=this;classCallCheck(this,a),this._settings=b,c.getToken().then(function(a){d._settings.token=a})}return createClass(a,[{key:'getAssetById',value:function(a){var b=this;return new Promise(function(c,d){var e=new XMLHttpRequest;e.open('GET',b._settings.apiEndpoint+'/assets/'+a,!0),e.addEventListener('load',function(){handleResponse(e).then(function(a){c(a)}).catch(function(a){d(a)})},!1),e.send()})}},{key:'getAssets',value:function(a){var b=this;return new Promise(function(c,d){var e=new XMLHttpRequest,f='';for(var g in a)''!=f&&(f+='&'),f+=g+'='+encodeURIComponent(a[g]);e.open('GET',b._settings.apiEndpoint+'/assets?'+f,!0),e.addEventListener('load',function(){handleResponse(e).then(function(a){c(a)}).catch(function(a){d(a)})},!1),e.send()})}},{key:'createAsset',value:function(a){var b=this;return new Promise(function(c,d){var e=new XMLHttpRequest;e.open('POST',b._settings.apiEndpoint+'/assets',!0),e.setRequestHeader('Content-type','application/json; charset=utf-8'),e.setRequestHeader('Authorization','AMB '+b._settings.secret),e.onload=function(){handleResponse(e).then(function(a){c(a)}).catch(function(a){d(a)})},e.send(JSON.stringify(a))})}}]),a}(),Events=function(){function a(b,c){var d=this;classCallCheck(this,a),this._settings=b,c.getToken().then(function(a){d._settings.token=a})}return createClass(a,[{key:'getEventById',value:function(a){var b=this;return new Promise(function(c,d){var e=new XMLHttpRequest;e.open('GET',b._settings.apiEndpoint+'/events/'+a,!0),e.addEventListener('load',function(){handleResponse(e).then(function(a){c(a)}).catch(function(a){d(a)})},!1),e.send()})}},{key:'getEvents',value:function(a){var b=this;return new Promise(function(c,d){var e=new XMLHttpRequest,f='';for(var g in a)''!=f&&(f+='&'),f+=g+'='+encodeURIComponent(a[g]);e.open('GET',b._settings.apiEndpoint+'/events?'+f,!0),e.addEventListener('load',function(){handleResponse(e).then(function(a){c(a)}).catch(function(a){d(a)})},!1),e.send()})}},{key:'createEvent',value:function(a,b){var c=this;return new Promise(function(d,e){var f=new XMLHttpRequest;f.open('POST',c._settings.apiEndpoint+'/assets/'+a+'/events',!0),f.setRequestHeader('Content-type','application/json; charset=utf-8'),f.setRequestHeader('Authorization','AMB '+c._settings.secret),f.onload=function(){handleResponse(f).then(function(a){d(a)}).catch(function(a){e(a)})},f.send(JSON.stringify(b))})}}]),a}(),Auth=function(){function a(b){if(classCallCheck(this,a),this._settings=b,!this._settings||!this._settings.secret||!this._settings.token||this._settings.address)return console.error('Secret key and account address are required in order to generate an access token.'),!1}return createClass(a,[{key:'getToken',value:function(){var a=this;return new Promise(function(b){if(a._settings.token)b(a._settings.token);else{var c=new XMLHttpRequest;c.open('POST',a._settings.apiEndpoint+'/token',!0),c.setRequestHeader('Content-type','application/json; charset=utf-8'),c.setRequestHeader('Authorization','AMB '+a._settings.secret),c.onload=function(){a._settings.token=JSON.parse(c.responseText),b(a._settings.token)},c.send(JSON.stringify({validUntil:16e8}))}})}}]),a}(),checkTimeStamp=function(a){var b=Math.floor(Date.now()/1e3);return a.content&&a.content.idData&&a.content.idData.timestamp?a.content.idData.timestamp:b},AmbrosusSDK=function(){function a(b){for(var c in classCallCheck(this,a),this._settings={apiEndpoint:'https://gateway-test.ambrosus.com'},b)b.hasOwnProperty(c)&&(this._settings[c]=b[c]);this._auth=new Auth(this._settings),this._assets=new Assets(this._settings,this._auth),this._events=new Events(this._settings,this._auth)}return createClass(a,[{key:'getAssetById',value:function(a){var b=this;return new Promise(function(c,d){return a?b._assets.getAssetById(a).then(function(a){c(a)}).catch(function(a){d(a)}):d(rejectResponse('Asset ID is missing.'))})}},{key:'getEventById',value:function(a){var b=this;return new Promise(function(c,d){return a?b._events.getEventById(a).then(function(a){c(a)}).catch(function(a){d(a)}):d(rejectResponse('Event ID is missing.'))})}},{key:'getAssets',value:function(){var a=this,b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(c,d){return a._assets.getAssets(b).then(function(a){c(a)}).catch(function(a){d(a)})})}},{key:'getEvents',value:function(a){var b=this;return new Promise(function(c,d){return b._events.getEvents(a).then(function(a){c(a)}).catch(function(a){d(a)})})}},{key:'createAsset',value:function(){var a=this,b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(c,d){if(!b)return d(rejectResponse('Asset data is missing.'));var e={content:{idData:{createdBy:a._settings.address,timestamp:checkTimeStamp(b),sequenceNumber:0}}};return b.data&&(e.data=b.data),a._assets.createAsset(e).then(function(d){if(1<=b.length){for(var e=[],f=function(c){e[c]=new Promise(function(e){return a.createEvent(d.data.assetId,b[c]).then(function(a){e(a)})})},g=0;g<b.length;g++)f(g);c(d)}c(d)}).catch(function(a){d(a)})})}},{key:'createEvent',value:function(a,b){var c=this;return new Promise(function(d,e){if(!a)return e(rejectResponse('Asset ID is missing.'));if(!b)return e(rejectResponse('Event data is missing.'));var f={content:{idData:{assetId:a,timestamp:checkTimeStamp(b),accessLevel:0,createdBy:c._settings.address}}};if(b.content&&b.content.data)f.content.data=b.content.data;else return e(rejectResponse('Invalid data: No content found at content.data.'));return c._events.createEvent(a,f).then(function(a){d(a)}).catch(function(a){e(a)})})}}]),a}();module.exports=AmbrosusSDK;
