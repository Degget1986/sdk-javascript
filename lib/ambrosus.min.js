var AmbrosusSDK=function(){'use strict';var a=function(a){return new Promise(function(b,c){var d={status:a.status,data:null,message:JSON.parse(a.response).reason};(200===a.status||201===a.status)&&(d.data=JSON.parse(a.response),d.message='success',b(d)),c(d)})},b=function(a){return{status:400,data:null,message:a}},c=function(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')},d=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=function(){function b(a,d){var e=this;c(this,b),this._settings=a,d.getToken().then(function(a){e._settings.token=a})}return d(b,[{key:'getAssetById',value:function(b){var c=this;return new Promise(function(d,e){var f=new XMLHttpRequest;f.open('GET',c._settings.apiEndpoint+'/assets/'+b,!0),f.addEventListener('load',function(){a(f).then(function(a){d(a)}).catch(function(a){e(a)})},!1),f.send()})}},{key:'getAssets',value:function(b){var c=this;return new Promise(function(d,e){var f=new XMLHttpRequest,g='';for(var h in b)''!=g&&(g+='&'),g+=h+'='+encodeURIComponent(b[h]);f.open('GET',c._settings.apiEndpoint+'/assets?'+g,!0),f.addEventListener('load',function(){a(f).then(function(a){d(a)}).catch(function(a){e(a)})},!1),f.send()})}},{key:'createAsset',value:function(b){var c=this;return new Promise(function(d,e){var f=new XMLHttpRequest;f.open('POST',c._settings.apiEndpoint+'/assets',!0),f.setRequestHeader('Content-type','application/json; charset=utf-8'),f.setRequestHeader('Authorization','AMB '+c._settings.secret),f.onload=function(){a(f).then(function(a){d(a)}).catch(function(a){e(a)})},f.send(JSON.stringify(b))})}}]),b}(),f=function(){function b(a,d){var e=this;c(this,b),this._settings=a,d.getToken().then(function(a){e._settings.token=a})}return d(b,[{key:'getEventById',value:function(b){var c=this;return new Promise(function(d,e){var f=new XMLHttpRequest;f.open('GET',c._settings.apiEndpoint+'/events/'+b,!0),f.addEventListener('load',function(){a(f).then(function(a){d(a)}).catch(function(a){e(a)})},!1),f.send()})}},{key:'getEvents',value:function(b){var c=this;return new Promise(function(d,e){var f=new XMLHttpRequest,g='';for(var h in b)''!=g&&(g+='&'),g+=h+'='+encodeURIComponent(b[h]);f.open('GET',c._settings.apiEndpoint+'/events?'+g,!0),f.addEventListener('load',function(){a(f).then(function(a){d(a)}).catch(function(a){e(a)})},!1),f.send()})}},{key:'createEvent',value:function(b,c){var d=this;return new Promise(function(e,f){var g=new XMLHttpRequest;g.open('POST',d._settings.apiEndpoint+'/assets/'+b+'/events',!0),g.setRequestHeader('Content-type','application/json; charset=utf-8'),g.setRequestHeader('Authorization','AMB '+d._settings.secret),g.onload=function(){a(g).then(function(a){e(a)}).catch(function(a){f(a)})},g.send(JSON.stringify(c))})}}]),b}(),g=function(){function a(b){if(c(this,a),this._settings=b,!this._settings||!this._settings.secret||!this._settings.token||this._settings.address)return console.error('Secret key and account address are required in order to generate an access token.'),!1}return d(a,[{key:'getToken',value:function(){var a=this;return new Promise(function(b){if(a._settings.token)b(a._settings.token);else{var c=new XMLHttpRequest;c.open('POST',a._settings.apiEndpoint+'/token',!0),c.setRequestHeader('Content-type','application/json; charset=utf-8'),c.setRequestHeader('Authorization','AMB '+a._settings.secret),c.onload=function(){a._settings.token=JSON.parse(c.responseText),b(a._settings.token)},c.send(JSON.stringify({validUntil:16e8}))}})}}]),a}(),h=function(a){var b=Math.floor(Date.now()/1e3);return a.content&&a.content.idData&&a.content.idData.timestamp?a.content.idData.timestamp:b},i=function(){function a(b){for(var d in c(this,a),this._settings={apiEndpoint:'https://gateway-test.ambrosus.com'},b)b.hasOwnProperty(d)&&(this._settings[d]=b[d]);this._auth=new g(this._settings),this._assets=new e(this._settings,this._auth),this._events=new f(this._settings,this._auth)}return d(a,[{key:'getAssetById',value:function(a){var c=this;return new Promise(function(d,e){return a?c._assets.getAssetById(a).then(function(a){d(a)}).catch(function(a){e(a)}):e(b('Asset ID is missing.'))})}},{key:'getEventById',value:function(a){var c=this;return new Promise(function(d,e){return a?c._events.getEventById(a).then(function(a){d(a)}).catch(function(a){e(a)}):e(b('Event ID is missing.'))})}},{key:'getAssets',value:function(){var a=this,b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(c,d){return a._assets.getAssets(b).then(function(a){c(a)}).catch(function(a){d(a)})})}},{key:'getEvents',value:function(a){var b=this;return new Promise(function(c,d){return b._events.getEvents(a).then(function(a){c(a)}).catch(function(a){d(a)})})}},{key:'createAsset',value:function(){var a=this,c=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(d,e){if(!c)return e(b('Asset data is missing.'));var f={content:{idData:{createdBy:a._settings.address,timestamp:h(c),sequenceNumber:0}}};return c.data&&(f.data=c.data),a._assets.createAsset(f).then(function(b){if(1<=c.length){for(var e=[],f=function(d){e[d]=new Promise(function(e){return a.createEvent(b.data.assetId,c[d]).then(function(a){e(a)})})},g=0;g<c.length;g++)f(g);d(b)}d(b)}).catch(function(a){e(a)})})}},{key:'createEvent',value:function(a,c){var d=this;return new Promise(function(e,f){if(!a)return f(b('Asset ID is missing.'));if(!c)return f(b('Event data is missing.'));var g={content:{idData:{assetId:a,timestamp:h(c),accessLevel:0,createdBy:d._settings.address}}};if(c.content&&c.content.data)g.content.data=c.content.data;else return f(b('Invalid data: No content found at content.data.'));return d._events.createEvent(a,g).then(function(a){e(a)}).catch(function(a){f(a)})})}}]),a}();return i}();
